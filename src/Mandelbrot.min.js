function Mandelbrot(){}Mandelbrot.COLORMAP={},Mandelbrot.COLORMAP.COLORED=function(a){var b=[0,0,0];if(a!=this.maxIteration){var c=3*Math.log(a)/Math.log(this.maxIteration-1);return 1>c?(b[0]=255*c,b):(b[0]=255,b[1]=255,2>c?b[1]*=c-1:b[2]=255*(c-2),b)}return b},Mandelbrot.COLORMAP.DEFAULT=function(a){var b=a/this.maxIteration*255&255;return[b,b,b]},Mandelbrot.prototype.colorMap=Mandelbrot.COLORMAP.DEFAULT,Mandelbrot.prototype.maxIteration=1024,Mandelbrot.prototype.width=100,Mandelbrot.prototype.height=100,Mandelbrot.prototype.toObj=function(){return{width:this.width,height:this.height,maxIteration:this.maxIteration,colorMap:this.colorMap.name}},Mandelbrot.prototype.getIterations=function(){for(var a,b,c=this.width,d=this.height,e=this.maxIteration,f=0,g=[],h=0;d>h;h++)for(b=0;c>b;b++){a=0;for(var i=0,j=0;a++<e;){var k=i*i-j*j+((b<<1)-1.5*c)/c;if(j=2*i*j+((h<<1)-d)/d,i=k,i*i+j*j>4)break}g[f++]=a}return g},Mandelbrot.prototype.render=function(a){for(var b=a.getContext("2d"),c=b.createImageData(this.width,this.height),d=this.getIterations(),e=0,f=d.length;f>e;e++){var g=this.colorMap(d[e]);c.data[4*e+0]=g[0],c.data[4*e+1]=g[1],c.data[4*e+2]=g[2],c.data[4*e+3]=255}b.putImageData(c,0,0)};var SETOBJ=0,RENDER=1,DONE=2;if(!this.window&&-1!=this.constructor.name.toLowerCase().indexOf("worker")){var current=null;Mandelbrot.prototype.render=function(a){for(var b=new Uint8Array(a),c=this.getIterations(),d=0,e=c.length;e>d;d++){var f=this.colorMap(c[d]);b[4*d+0]=f[0],b[4*d+1]=f[1],b[4*d+2]=f[2],b[4*d+3]=255}},this.onmessage=function(a){var b=a.data.cmd;switch(b){case SETOBJ:var c=a.data.mandelbrot,d=new Mandelbrot;for(var e in c)d[e]=c[e];d.colorMap=Mandelbrot.COLORMAP[d.colorMap],current=d;break;case RENDER:var f=a.data.buffer;current.render(f),postMessage({cmd:DONE})}}}