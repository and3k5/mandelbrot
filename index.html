
<html>
    <head>
		<title>Mandelbrot JavaScript Worker by And3k5</title>
	</head>
	<body>
		<canvas width="280" height="192" style="background-color:black;"></canvas>
		<script>
			
			if (!(function () {
				try {
					var test = new Worker("worker.js");
					if (window.addEventListener) {
						return true;
					} else {
						return false;
					}
				} catch (e) {
					return false;
				}
				return true;
			})()) {
				alert("Sorry, it seems that your browser doesn't support Workers\nIf you're using Internet Explorer, consider downloading another browser - please!");
			}else{
				var worker = new Worker("worker.js");
				var ctx=document.querySelector("canvas").getContext("2d");
				method=1;
				switch (method) {
					case 0:
						worker.addEventListener('message', function(e) {
							ctx.fillStyle=JSON.parse(e.data)[1];
							ctx.fillRect(JSON.parse(e.data)[0][0],JSON.parse(e.data)[0][1],JSON.parse(e.data)[0][2],JSON.parse(e.data)[0][3]);
							ctx.fillRect(JSON.parse(e.data)[0][0],191-JSON.parse(e.data)[0][1],JSON.parse(e.data)[0][2],JSON.parse(e.data)[0][3]);
							//console.log(JSON.parse(e.data)[1]);
						},false);
						break;
					case 1:
						var pixtable=[];
						worker.addEventListener('message', function(e) {
							pixtable.push({style:JSON.parse(e.data)[1],x:JSON.parse(e.data)[0][0],y:JSON.parse(e.data)[0][1],w:JSON.parse(e.data)[0][2],h:JSON.parse(e.data)[0][3]});
							//ctx.fillRect(JSON.parse(e.data)[0][0],191-JSON.parse(e.data)[0][1],1,1);
							//console.log(JSON.parse(e.data)[1]);
						},false);
						(function () {
							ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
							for (i in pixtable) {
								ctx.fillStyle=pixtable[i].style;
								ctx.fillRect(pixtable[i].x,pixtable[i].y,pixtable[i].w,pixtable[i].h);
								ctx.fillRect(pixtable[i].x,191-pixtable[i].y,pixtable[i].w,pixtable[i].h);
							}
							setTimeout(arguments.callee,16);
						})();
						break;
				}
				
				
				worker.postMessage([280,192,8,8,1,512*2]);
			}
		</script>
		<form id="formS" method="get" action="index.html">
			<fieldset>
				<p>
					<label for="width">Width</label>
					<input id="width" type="number" value="280"></input>
				</p>
				<p>
					<label for="height">Height</label>
					<input id="height" type="number" value="192"></input>
				</p>
				<p>
					<label for="proc_w">Processor division (width)</label>
					<input id="proc_w" type="number" value="8"></input>
				</p>
				<p>
					<label for="proc_h">Processor division (width)</label>
					<input id="proc_h" type="number" value="8"></input>
				</p>
				<p>
					<label for="quality">Quality</label>
					<input id="quality" type="number" value="1">(1: normal, 2: low, 0.5: high (acts weird))</input>
				</p>
				<p>
					<label for="iterations">Quality</label>
					<input id="iterations" type="number" value="512"></input>
				</p>
				<p>
					<input type="submit"></input>
				</p>
			</fieldset>
		</form>
		<script>
			formS.onsubmit = function (e) { 
				console.log(this);
				ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
				ctx.canvas.width=parseInt(formS.width.value);
				ctx.canvas.height=parseInt(formS.height.value)
				worker.postMessage([parseInt(formS.width.value),parseInt(formS.height.value),parseInt(formS.proc_w.value),parseInt(formS.proc_h.value),parseInt(formS.quality.value),parseInt(formS.iterations.value)]);
				pixtable=[];
				e.preventDefault();
			
			}
		</script>
	</body>
</html>